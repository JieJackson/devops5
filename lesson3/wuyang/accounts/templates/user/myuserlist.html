{% extends "public/layout.html" %}

{% block breadcrumb %}
<li><a href="#">用户管理</a></li>
<li><a href="#">用户列表</a></li>
{% endblock %}

{% block body %}
<!--用户列表展示-->
    <table class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>用户名</th>
            <th>邮箱</th>
            <th>用户状态</th>
            <th>最后登陆时间</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
    {% for user_obj in object_list %}
        <tr>
            <td> {{ forloop.counter }}</td>
            <td> {{ user_obj.username }}</td>
            <td> {{ user_obj.email }}</td>
            <td> {{ user_obj.is_active }}</td>
            <td> {{ user_obj.last_login|date:"Y-m-d H:i:s" }}</td>
            <td>
                <div class="btn-group">
                    <div class="btn-group">
                        <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
                            修改
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Something else here</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="" data='{"uid": "{{ user_obj.id }}", "username": "{{ user_obj.username }}" }' class="user_to_group">添加到指定组</a></li>
                        </ul>
                    </div>
                    {% if user_obj.is_active %}
                        <button type="button" class="btn btn-sm btn-warning modify_user_status" status={{ user_obj.is_active|lower  }} data="{{ user_obj.id }}">禁用</button>
                    {% else %}
                        <button type="button" class="btn btn-info btn-sm modify_user_status" status={{ user_obj.is_active|lower }} data="{{ user_obj.id }}">开启</button>
                    {% endif %}
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!--分页代码段-->
    <div class="panel-default">
	<center>
		<ul class="pagination">
            <li><a href="{{ request.path }}?page=1">首页</a></li>
            <li>
                {% if page_obj.has_previous %}
                <a href="{{ request.path }}?page={{  page_obj.previous_page_number }}">上一页</a>
                {% endif %}
            </li>
            {% for page_number in page_range %}
                <li {% if page_number == page_obj.number %}class="active"{% endif %} ><a href="{{ request.path }}?page={{ page_number }}">{{ page_number }}</a></li>
            {% endfor %}

            <li>
                {% if page_obj.has_next %}
                <a href="{{ request.path }}?page={{ page_obj.next_page_number }}">下一页</a>
                {% endif %}
            </li>
            <li><a href="{{ request.path }}?page={{ paginator.num_pages }}">尾页</a></li>
		</ul>
	</center>
    </div>

{% endblock %}

{% block js %}
<script>
$(function(){
    $(".modify_user_status").click(function(){
        var click_obj = $(this);
        var uid = click_obj.attr('data');
        var status = click_obj.attr('status');
        //console.log(uid,status)
        $.ajax({
            url:"{% url 'myuser_modify_status' %}",
            type:"post",
            data: {"uid": uid},
            success: function(ret){
                //console.log(ret)
                if(ret.status!=0){
                    swal("操作失败",ret.errmsg,"error")
                }
                else{
                    window.location.reload()
                }

            },
            beforeSend: function (xhr, settings) {
                var csrftoken = getCookie('csrftoken');
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken)
                }
            },
        }

        )

    })



})




</script>
{% endblock js %}